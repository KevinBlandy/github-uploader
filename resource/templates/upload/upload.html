<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>{{ .title }}</title>
    </head>
    <body>
    <form id="form">
        <input name="file" type="file" multiple="multiple" accept="image/*"/>
    </form>
    </body>
    <script>

        window.onload = () => {
            document.querySelector(`input[name="file"]`).addEventListener('change', (e) => {
                const files = e.target.files
                if (!files) {
                    return
                }
                const formData = new FormData(document.querySelector('#form'))
                const xhr = new XMLHttpRequest()
                xhr.open("POST", "/upload")
                if (xhr.upload){
                    xhr.upload.onprogress = e => {
                        const percent  = ((e.loaded / e.total) * 100).toFixed(2);
                        console.log(`上传进度 ${percent}`);
                    }
                }
                xhr.onload = e => {
                    document.querySelector('#form').reset()
                    const message = JSON.parse(xhr.responseText)
                    if (message.success){
                        console.log(message)
                    } else {
                        const errorMessage = message.message
                        alert(errorMessage);
                    }
                };
                xhr.send(formData)
            })
        }
    </script>
</html>